version: "3.7"

services:
  
  ingest-pipeline:
    volumes:
      # Mount the source code to container.  This includes the instance/app.cfg file
      # one directory below.
      - "../src/ingest-pipeline:/usr/src/app/src"
      # Logic for finding schemata from dags requires a specific route to schemata
      - "../src/ingest-pipeline/schemata:/usr/local/schemata"
      # Map the actual root of the staging area to container
      - "/hubmap-data:/usr/local/airflow/lz"
      # Map the actual root of the scratch area to container
      - "/hubmap-scratch:/hubmap-scratch"
    environment:
      - AIRFLOW_CONN_INGEST_API_CONNECTION=http://hubmap-auth:4444/
      - AIRFLOW__WEBSERVER__WEB_SERVER_PORT=8789
      - FLASK_RUN_PORT=8789



